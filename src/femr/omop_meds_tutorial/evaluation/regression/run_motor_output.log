Using configuration:
  COHORT_BASE_DIR:          /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/
  PRETRAINING_DATA:         /user/zj2398/cache/mtpp_8k
  OMOP_MEDS_READER:         /shared/share_mala/zj2398/mimic/meds_v0.6_reader
  NUM_PROC:                 64
  TOKENS_PER_BATCH:         65536
  OBSERVATION_WINDOW:       Not specified
  REGRESSION:               true
  PYTHONPATH head:          /user/zj2398/femr_chao_meds_v3/src
  RUN_ROOT (outputs):       /user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/regression

[1] Found task: bilirubin
[2] Found task: creatinine
[3] Found task: pao2
[4] Found task: platelets
[1/4] Processing task: bilirubin
cohort_base_dir: /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/
Task directory: /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/bilirubin/
Executing: python -u "/user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/generate_mtpp_features.py"         --pretraining_data "/user/zj2398/cache/mtpp_8k"         --model_path "/user/zj2398/cache/mtpp_8k/mtpp_mean_all/best_134150"         --model_name "mtpp"         --meds_reader "/shared/share_mala/zj2398/mimic/meds_v0.6_reader"         --num_proc "64"         --tokens_per_batch "65536"         --device "cuda:0"         --min_subjects_per_batch "8"         --cohort_dir "/shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/bilirubin/"         --ontology_path "/user/zj2398/cache/mtpp_8k/ontology.pkl"         --output_root "/shared/share_mala/zj2398/mimic/regression/mtpp/"         --loss_type labeled_subjects         --task_type regression 
label_name of cohort_dir: bilirubin
/shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/bilirubin/bilirubin.parquet
Loading labels from  /shared/share_mala/zj2398/mimic/regression/mtpp/labels/bilirubin.parquet
labels head:    patient_id     prediction_time               code  numerical_value
0    10515013 2144-12-27 00:45:00  LAB//50885//mg/dL              NaN
1    10515522 2157-06-26 02:30:00  LAB//50885//mg/dL              NaN
2    10515638 2149-08-28 00:07:00  LAB//50885//mg/dL              NaN
3    10515638 2149-09-05 13:54:00  LAB//50885//mg/dL              NaN
4    10515638 2149-09-12 03:25:00  LAB//50885//mg/dL              NaN
task type is regression
Traceback (most recent call last):
  File "/user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/generate_mtpp_features.py", line 228, in <module>
    main()
  File "/user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/generate_mtpp_features.py", line 191, in main
    typed_labels = [
                   ^
  File "/user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/generate_mtpp_features.py", line 193, in <listcomp>
    subject_id=label["subject_id"],
               ~~~~~^^^^^^^^^^^^^^
KeyError: 'subject_id'
Error: feature generation failed for bilirubin
----------------------------------------
[2/4] Processing task: creatinine
cohort_base_dir: /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/
Task directory: /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/creatinine/
Executing: python -u "/user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/generate_mtpp_features.py"         --pretraining_data "/user/zj2398/cache/mtpp_8k"         --model_path "/user/zj2398/cache/mtpp_8k/mtpp_mean_all/best_134150"         --model_name "mtpp"         --meds_reader "/shared/share_mala/zj2398/mimic/meds_v0.6_reader"         --num_proc "64"         --tokens_per_batch "65536"         --device "cuda:0"         --min_subjects_per_batch "8"         --cohort_dir "/shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/creatinine/"         --ontology_path "/user/zj2398/cache/mtpp_8k/ontology.pkl"         --output_root "/shared/share_mala/zj2398/mimic/regression/mtpp/"         --loss_type labeled_subjects         --task_type regression 
Using configuration:
  COHORT_BASE_DIR:          /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/
  PRETRAINING_DATA:         /user/zj2398/cache/mtpp_8k
  OMOP_MEDS_READER:         /shared/share_mala/zj2398/mimic/meds_v0.6_reader
  NUM_PROC:                 64
  TOKENS_PER_BATCH:         65536
  OBSERVATION_WINDOW:       Not specified
  REGRESSION:               true
  PYTHONPATH head:          /user/zj2398/femr_chao_meds_v3/src
  RUN_ROOT (outputs):       /user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/regression

[1] Found task: bilirubin
[2] Found task: creatinine
[3] Found task: pao2
[4] Found task: platelets
[1 skipped] Skipping task: bilirubin (not in specified task list)
[2 skipped] Skipping task: creatinine (not in specified task list)
[1/4] Processing task: pao2
cohort_base_dir: /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/
Task directory: /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/pao2/
Executing: python -u "/user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/generate_mtpp_features.py"         --pretraining_data "/user/zj2398/cache/mtpp_8k"         --model_path "/user/zj2398/cache/mtpp_8k/mtpp_mean_all/best_134150"         --model_name "mtpp"         --meds_reader "/shared/share_mala/zj2398/mimic/meds_v0.6_reader"         --num_proc "64"         --tokens_per_batch "65536"         --device "cuda:0"         --min_subjects_per_batch "8"         --cohort_dir "/shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/pao2/"         --ontology_path "/user/zj2398/cache/mtpp_8k/ontology.pkl"         --output_root "/shared/share_mala/zj2398/mimic/regression/mtpp/"         --loss_type labeled_subjects         --task_type regression 
label_name of cohort_dir: creatinine
/shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/creatinine/creatinine.parquet
Loading labels from  /shared/share_mala/zj2398/mimic/regression/mtpp/labels/creatinine.parquet
labels head:    patient_id     prediction_time               code  numerical_value
0    16311969 2125-02-17 01:23:00  LAB//50912//mg/dL              NaN
1    16311969 2125-02-18 01:15:00  LAB//50912//mg/dL              NaN
2    16311969 2125-02-18 21:59:00  LAB//50912//mg/dL              NaN
3    16311969 2125-02-19 13:31:00  LAB//50912//mg/dL              NaN
4    16311969 2125-02-20 01:04:00  LAB//50912//mg/dL              NaN
task type is regression
label_name of cohort_dir: pao2
/shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/pao2/pao2.parquet
Loading labels from  /shared/share_mala/zj2398/mimic/regression/mtpp/labels/pao2.parquet
labels head:    patient_id     prediction_time               code  numerical_value
0    11017644 2174-01-19 05:26:00  LAB//50821//mm Hg              NaN
1    11017644 2174-01-19 08:33:00  LAB//50821//mm Hg              NaN
2    11017644 2174-01-19 10:06:00  LAB//50821//mm Hg              NaN
3    11017644 2174-01-19 12:09:00  LAB//50821//mm Hg              NaN
4    11017644 2174-01-19 15:22:00  LAB//50821//mm Hg              NaN
task type is regression
Traceback (most recent call last):
  File "/user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/generate_mtpp_features.py", line 228, in <module>
    main()
  File "/user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/generate_mtpp_features.py", line 191, in main
    typed_labels = [
                   ^
  File "/user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/generate_mtpp_features.py", line 193, in <listcomp>
    subject_id=label["subject_id"],
               ~~~~~^^^^^^^^^^^^^^
KeyError: 'subject_id'
Using configuration:
  COHORT_BASE_DIR:          /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/
  PRETRAINING_DATA:         /user/zj2398/cache/mtpp_8k
  OMOP_MEDS_READER:         /shared/share_mala/zj2398/mimic/meds_v0.6_reader
  NUM_PROC:                 64
  TOKENS_PER_BATCH:         65536
  OBSERVATION_WINDOW:       Not specified
  REGRESSION:               true
  PYTHONPATH head:          /user/zj2398/femr_chao_meds_v3/src
  RUN_ROOT (outputs):       /user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/regression

[1] Found task: bilirubin
[2] Found task: creatinine
[3] Found task: pao2
[4] Found task: platelets
[1/4] Processing task: bilirubin
cohort_base_dir: /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/
Task directory: /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/bilirubin/
Executing: python -u "/user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/generate_mtpp_features.py"         --pretraining_data "/user/zj2398/cache/mtpp_8k"         --model_path "/user/zj2398/cache/mtpp_8k/mtpp_mean_all/best_134150"         --model_name "mtpp"         --meds_reader "/shared/share_mala/zj2398/mimic/meds_v0.6_reader"         --num_proc "64"         --tokens_per_batch "65536"         --device "cuda:0"         --min_subjects_per_batch "8"         --cohort_dir "/shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/bilirubin/"         --ontology_path "/user/zj2398/cache/mtpp_8k/ontology.pkl"         --output_root "/shared/share_mala/zj2398/mimic/regression/mtpp/"         --loss_type labeled_subjects         --task_type regression 
label_name of cohort_dir: bilirubin
/shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/bilirubin/bilirubin.parquet
Loading labels from  /shared/share_mala/zj2398/mimic/regression/mtpp/labels/bilirubin.parquet
labels head:    patient_id     prediction_time               code  numerical_value
0    10515013 2144-12-27 00:45:00  LAB//50885//mg/dL              NaN
1    10515522 2157-06-26 02:30:00  LAB//50885//mg/dL              NaN
2    10515638 2149-08-28 00:07:00  LAB//50885//mg/dL              NaN
3    10515638 2149-09-05 13:54:00  LAB//50885//mg/dL              NaN
4    10515638 2149-09-12 03:25:00  LAB//50885//mg/dL              NaN
task type is regression
Traceback (most recent call last):
  File "/user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/generate_mtpp_features.py", line 228, in <module>
    main()
  File "/user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/generate_mtpp_features.py", line 191, in main
    typed_labels = [
                   ^
  File "/user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/generate_mtpp_features.py", line 193, in <listcomp>
    subject_id=label["subject_id"],
               ~~~~~^^^^^^^^^^^^^^
KeyError: 'subject_id'
Error: feature generation failed for bilirubin
----------------------------------------
[2/4] Processing task: creatinine
cohort_base_dir: /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/
Task directory: /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/creatinine/
Executing: python -u "/user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/generate_mtpp_features.py"         --pretraining_data "/user/zj2398/cache/mtpp_8k"         --model_path "/user/zj2398/cache/mtpp_8k/mtpp_mean_all/best_134150"         --model_name "mtpp"         --meds_reader "/shared/share_mala/zj2398/mimic/meds_v0.6_reader"         --num_proc "64"         --tokens_per_batch "65536"         --device "cuda:0"         --min_subjects_per_batch "8"         --cohort_dir "/shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/creatinine/"         --ontology_path "/user/zj2398/cache/mtpp_8k/ontology.pkl"         --output_root "/shared/share_mala/zj2398/mimic/regression/mtpp/"         --loss_type labeled_subjects         --task_type regression 
Using configuration:
  COHORT_BASE_DIR:          /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/
  PRETRAINING_DATA:         /user/zj2398/cache/mtpp_8k
  OMOP_MEDS_READER:         /shared/share_mala/zj2398/mimic/meds_v0.6_reader
  NUM_PROC:                 64
  TOKENS_PER_BATCH:         65536
  OBSERVATION_WINDOW:       Not specified
  REGRESSION:               true
  PYTHONPATH head:          /user/zj2398/femr_chao_meds_v3/src
  RUN_ROOT (outputs):       /user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/regression

[1] Found task: bilirubin
[2] Found task: creatinine
[3] Found task: pao2
[4] Found task: platelets
[1 skipped] Skipping task: bilirubin (not in specified task list)
[2 skipped] Skipping task: creatinine (not in specified task list)
[1/4] Processing task: pao2
cohort_base_dir: /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/
Task directory: /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/pao2/
Executing: python -u "/user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/generate_mtpp_features.py"         --pretraining_data "/user/zj2398/cache/mtpp_8k"         --model_path "/user/zj2398/cache/mtpp_8k/mtpp_mean_all/best_134150"         --model_name "mtpp"         --meds_reader "/shared/share_mala/zj2398/mimic/meds_v0.6_reader"         --num_proc "64"         --tokens_per_batch "65536"         --device "cuda:0"         --min_subjects_per_batch "8"         --cohort_dir "/shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/pao2/"         --ontology_path "/user/zj2398/cache/mtpp_8k/ontology.pkl"         --output_root "/shared/share_mala/zj2398/mimic/regression/mtpp/"         --loss_type labeled_subjects         --task_type regression 
Using configuration:
  COHORT_BASE_DIR:          /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/
  PRETRAINING_DATA:         /user/zj2398/cache/mtpp_8k
  OMOP_MEDS_READER:         /shared/share_mala/zj2398/mimic/meds_v0.6_reader
  NUM_PROC:                 64
  TOKENS_PER_BATCH:         65536
  OBSERVATION_WINDOW:       Not specified
  REGRESSION:               true
  PYTHONPATH head:          /user/zj2398/femr_chao_meds_v3/src
  RUN_ROOT (outputs):       /user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/regression

[1] Found task: bilirubin
[2] Found task: creatinine
[3] Found task: pao2
[4] Found task: platelets
[1 skipped] Skipping task: bilirubin (not in specified task list)
[2 skipped] Skipping task: creatinine (not in specified task list)
[1/4] Processing task: pao2
cohort_base_dir: /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/
Task directory: /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/pao2/
Executing: python -u "/user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/generate_mtpp_features.py"         --pretraining_data "/user/zj2398/cache/mtpp_8k"         --model_path "/user/zj2398/cache/mtpp_8k/mtpp_mean_all/best_134150"         --model_name "mtpp"         --meds_reader "/shared/share_mala/zj2398/mimic/meds_v0.6_reader"         --num_proc "64"         --tokens_per_batch "65536"         --device "cuda:0"         --min_subjects_per_batch "8"         --cohort_dir "/shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/pao2/"         --ontology_path "/user/zj2398/cache/mtpp_8k/ontology.pkl"         --output_root "/shared/share_mala/zj2398/mimic/regression/mtpp/"         --loss_type labeled_subjects         --task_type regression 
label_name of cohort_dir: pao2
/shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/pao2/pao2.parquet
Loading labels from  /shared/share_mala/zj2398/mimic/regression/mtpp/labels/pao2.parquet
labels head:    subject_id     prediction_time               code  numerical_value
0         NaN 2134-12-05 23:29:00  LAB//50821//mm Hg              NaN
1         NaN 2131-01-11 07:33:00  LAB//50821//mm Hg              NaN
2         NaN 2131-01-11 10:48:00  LAB//50821//mm Hg              NaN
3         NaN 2131-01-11 18:21:00  LAB//50821//mm Hg              NaN
4         NaN 2131-01-11 23:48:00  LAB//50821//mm Hg              NaN
task type is regression
typed_labels length: 439054
Loading model from /user/zj2398/cache/mtpp_8k/mtpp_mean_all/best_134150
use_linear_interpolation: False
loss type is labeled_subjects
starting loading model
the hidden size is 768
create loss type is labeled_subjects
the report is LoadReport(renamed_keys=[('transformer.embed_bag.weight', 'backbone.embed_bag.weight'), ('transformer.in_norm.weight', 'backbone.in_norm.weight'), ('transformer.layers.0.input_proj.weight', 'backbone.layers.0.input_proj.weight'), ('transformer.layers.0.norm.weight', 'backbone.layers.0.norm.weight'), ('transformer.layers.0.output_proj.weight', 'backbone.layers.0.output_proj.weight'), ('transformer.layers.1.input_proj.weight', 'backbone.layers.1.input_proj.weight'), ('transformer.layers.1.norm.weight', 'backbone.layers.1.norm.weight'), ('transformer.layers.1.output_proj.weight', 'backbone.layers.1.output_proj.weight'), ('transformer.layers.10.input_proj.weight', 'backbone.layers.10.input_proj.weight'), ('transformer.layers.10.norm.weight', 'backbone.layers.10.norm.weight'), ('transformer.layers.10.output_proj.weight', 'backbone.layers.10.output_proj.weight'), ('transformer.layers.2.input_proj.weight', 'backbone.layers.2.input_proj.weight'), ('transformer.layers.2.norm.weight', 'backbone.layers.2.norm.weight'), ('transformer.layers.2.output_proj.weight', 'backbone.layers.2.output_proj.weight'), ('transformer.layers.3.input_proj.weight', 'backbone.layers.3.input_proj.weight'), ('transformer.layers.3.norm.weight', 'backbone.layers.3.norm.weight'), ('transformer.layers.3.output_proj.weight', 'backbone.layers.3.output_proj.weight'), ('transformer.layers.4.input_proj.weight', 'backbone.layers.4.input_proj.weight'), ('transformer.layers.4.norm.weight', 'backbone.layers.4.norm.weight'), ('transformer.layers.4.output_proj.weight', 'backbone.layers.4.output_proj.weight'), ('transformer.layers.5.input_proj.weight', 'backbone.layers.5.input_proj.weight'), ('transformer.layers.5.norm.weight', 'backbone.layers.5.norm.weight'), ('transformer.layers.5.output_proj.weight', 'backbone.layers.5.output_proj.weight'), ('transformer.layers.6.input_proj.weight', 'backbone.layers.6.input_proj.weight'), ('transformer.layers.6.norm.weight', 'backbone.layers.6.norm.weight'), ('transformer.layers.6.output_proj.weight', 'backbone.layers.6.output_proj.weight'), ('transformer.layers.7.input_proj.weight', 'backbone.layers.7.input_proj.weight'), ('transformer.layers.7.norm.weight', 'backbone.layers.7.norm.weight'), ('transformer.layers.7.output_proj.weight', 'backbone.layers.7.output_proj.weight'), ('transformer.layers.8.input_proj.weight', 'backbone.layers.8.input_proj.weight'), ('transformer.layers.8.norm.weight', 'backbone.layers.8.norm.weight'), ('transformer.layers.8.output_proj.weight', 'backbone.layers.8.output_proj.weight'), ('transformer.layers.9.input_proj.weight', 'backbone.layers.9.input_proj.weight'), ('transformer.layers.9.norm.weight', 'backbone.layers.9.norm.weight'), ('transformer.layers.9.output_proj.weight', 'backbone.layers.9.output_proj.weight'), ('transformer.out_norm.weight', 'backbone.out_norm.weight')], dropped_keys=['task_model.logvars', 'task_model.non_numerical_final_layer.bias', 'task_model.non_numerical_final_layer.weight', 'task_model.non_numerical_task_layer.bias', 'task_model.non_numerical_task_layer.weight', 'task_model.norm.weight', 'task_model.numerical_final_layer.bias', 'task_model.numerical_final_layer.weight', 'task_model.numerical_task_layer.bias', 'task_model.numerical_task_layer.weight'], missing_keys=[], unexpected_keys=[])
The maximum context length is 8192.0,  8 subjects and 65536 tokens per batch
max_length: 8192
Using configuration:
  COHORT_BASE_DIR:          /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/
  PRETRAINING_DATA:         /user/zj2398/cache/mtpp_8k
  OMOP_MEDS_READER:         /shared/share_mala/zj2398/mimic/meds_v0.6_reader
  NUM_PROC:                 64
  TOKENS_PER_BATCH:         65536
  OBSERVATION_WINDOW:       Not specified
  REGRESSION:               true
  PYTHONPATH head:          /user/zj2398/femr_chao_meds_v3/src
  RUN_ROOT (outputs):       /user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/regression

[1] Found task: bilirubin
[2] Found task: creatinine
[3] Found task: pao2
[4] Found task: platelets
[1 skipped] Skipping task: bilirubin (not in specified task list)
[2 skipped] Skipping task: creatinine (not in specified task list)
[1/4] Processing task: pao2
cohort_base_dir: /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/
Task directory: /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/pao2/
Executing: python -u "/user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/generate_mtpp_features.py"         --pretraining_data "/user/zj2398/cache/mtpp_8k"         --model_path "/user/zj2398/cache/mtpp_8k/mtpp_mean_all/best_134150"         --model_name "mtpp"         --meds_reader "/shared/share_mala/zj2398/mimic/meds_v0.6_reader"         --num_proc "64"         --tokens_per_batch "65536"         --device "cuda:0"         --min_subjects_per_batch "8"         --cohort_dir "/shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/pao2/"         --ontology_path "/user/zj2398/cache/mtpp_8k/ontology.pkl"         --output_root "/shared/share_mala/zj2398/mimic/regression/mtpp/"         --loss_type labeled_subjects         --task_type regression 
label_name of cohort_dir: pao2
/shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/pao2/pao2.parquet
Loading labels from  /shared/share_mala/zj2398/mimic/regression/mtpp/labels/pao2.parquet
labels head:    subject_id     prediction_time               code  numerical_value
0    10515010 2114-05-16 10:05:00  LAB//50821//mm Hg            244.0
1    10515010 2114-05-16 11:25:00  LAB//50821//mm Hg            299.0
2    10515010 2114-05-16 13:02:00  LAB//50821//mm Hg            159.0
3    10515010 2114-05-16 16:24:00  LAB//50821//mm Hg            136.0
4    10515010 2114-05-16 22:00:00  LAB//50821//mm Hg             41.0
task type is regression
typed_labels length: 439054
Loading model from /user/zj2398/cache/mtpp_8k/mtpp_mean_all/best_134150
use_linear_interpolation: False
loss type is labeled_subjects
starting loading model
the hidden size is 768
create loss type is labeled_subjects
the report is LoadReport(renamed_keys=[('transformer.embed_bag.weight', 'backbone.embed_bag.weight'), ('transformer.in_norm.weight', 'backbone.in_norm.weight'), ('transformer.layers.0.input_proj.weight', 'backbone.layers.0.input_proj.weight'), ('transformer.layers.0.norm.weight', 'backbone.layers.0.norm.weight'), ('transformer.layers.0.output_proj.weight', 'backbone.layers.0.output_proj.weight'), ('transformer.layers.1.input_proj.weight', 'backbone.layers.1.input_proj.weight'), ('transformer.layers.1.norm.weight', 'backbone.layers.1.norm.weight'), ('transformer.layers.1.output_proj.weight', 'backbone.layers.1.output_proj.weight'), ('transformer.layers.10.input_proj.weight', 'backbone.layers.10.input_proj.weight'), ('transformer.layers.10.norm.weight', 'backbone.layers.10.norm.weight'), ('transformer.layers.10.output_proj.weight', 'backbone.layers.10.output_proj.weight'), ('transformer.layers.2.input_proj.weight', 'backbone.layers.2.input_proj.weight'), ('transformer.layers.2.norm.weight', 'backbone.layers.2.norm.weight'), ('transformer.layers.2.output_proj.weight', 'backbone.layers.2.output_proj.weight'), ('transformer.layers.3.input_proj.weight', 'backbone.layers.3.input_proj.weight'), ('transformer.layers.3.norm.weight', 'backbone.layers.3.norm.weight'), ('transformer.layers.3.output_proj.weight', 'backbone.layers.3.output_proj.weight'), ('transformer.layers.4.input_proj.weight', 'backbone.layers.4.input_proj.weight'), ('transformer.layers.4.norm.weight', 'backbone.layers.4.norm.weight'), ('transformer.layers.4.output_proj.weight', 'backbone.layers.4.output_proj.weight'), ('transformer.layers.5.input_proj.weight', 'backbone.layers.5.input_proj.weight'), ('transformer.layers.5.norm.weight', 'backbone.layers.5.norm.weight'), ('transformer.layers.5.output_proj.weight', 'backbone.layers.5.output_proj.weight'), ('transformer.layers.6.input_proj.weight', 'backbone.layers.6.input_proj.weight'), ('transformer.layers.6.norm.weight', 'backbone.layers.6.norm.weight'), ('transformer.layers.6.output_proj.weight', 'backbone.layers.6.output_proj.weight'), ('transformer.layers.7.input_proj.weight', 'backbone.layers.7.input_proj.weight'), ('transformer.layers.7.norm.weight', 'backbone.layers.7.norm.weight'), ('transformer.layers.7.output_proj.weight', 'backbone.layers.7.output_proj.weight'), ('transformer.layers.8.input_proj.weight', 'backbone.layers.8.input_proj.weight'), ('transformer.layers.8.norm.weight', 'backbone.layers.8.norm.weight'), ('transformer.layers.8.output_proj.weight', 'backbone.layers.8.output_proj.weight'), ('transformer.layers.9.input_proj.weight', 'backbone.layers.9.input_proj.weight'), ('transformer.layers.9.norm.weight', 'backbone.layers.9.norm.weight'), ('transformer.layers.9.output_proj.weight', 'backbone.layers.9.output_proj.weight'), ('transformer.out_norm.weight', 'backbone.out_norm.weight')], dropped_keys=['task_model.logvars', 'task_model.non_numerical_final_layer.bias', 'task_model.non_numerical_final_layer.weight', 'task_model.non_numerical_task_layer.bias', 'task_model.non_numerical_task_layer.weight', 'task_model.norm.weight', 'task_model.numerical_final_layer.bias', 'task_model.numerical_final_layer.weight', 'task_model.numerical_task_layer.bias', 'task_model.numerical_task_layer.weight'], missing_keys=[], unexpected_keys=[])
The maximum context length is 8192.0,  8 subjects and 65536 tokens per batch
max_length: 8192
Using configuration:
  COHORT_BASE_DIR:          /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/
  PRETRAINING_DATA:         /user/zj2398/cache/mtpp_8k
  OMOP_MEDS_READER:         /shared/share_mala/zj2398/mimic/meds_v0.6_reader
  NUM_PROC:                 64
  TOKENS_PER_BATCH:         65536
  OBSERVATION_WINDOW:       Not specified
  REGRESSION:               true
  PYTHONPATH head:          /user/zj2398/femr_chao_meds_v3/src
  RUN_ROOT (outputs):       /user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/regression

[1] Found task: bilirubin
[2] Found task: creatinine
[3] Found task: pao2
[4] Found task: platelets
[1/4] Processing task: bilirubin
cohort_base_dir: /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/
Task directory: /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/bilirubin/
Executing: python -u "/user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/generate_mtpp_features.py"         --pretraining_data "/user/zj2398/cache/mtpp_8k"         --model_path "/user/zj2398/cache/mtpp_8k/mtpp_mean_all/best_134150"         --model_name "mtpp"         --meds_reader "/shared/share_mala/zj2398/mimic/meds_v0.6_reader"         --num_proc "64"         --tokens_per_batch "65536"         --device "cuda:0"         --min_subjects_per_batch "8"         --cohort_dir "/shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/bilirubin/"         --ontology_path "/user/zj2398/cache/mtpp_8k/ontology.pkl"         --output_root "/shared/share_mala/zj2398/mimic/regression/mtpp/"         --loss_type labeled_subjects         --task_type regression 
label_name of cohort_dir: bilirubin
/shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/bilirubin/bilirubin.parquet
Loading labels from  /shared/share_mala/zj2398/mimic/regression/mtpp/labels/bilirubin.parquet
labels head:    subject_id     prediction_time               code  numerical_value
0    10308187 2137-06-12 06:30:00  LAB//50885//mg/dL              0.3
1    10308187 2137-06-12 21:39:00  LAB//50885//mg/dL              0.4
2    10308187 2137-06-23 22:15:00  LAB//50885//mg/dL              0.2
3    10308247 2186-10-30 15:55:00  LAB//50885//mg/dL              5.0
4    10308247 2186-10-31 00:00:00  LAB//50885//mg/dL              6.9
task type is regression
typed_labels length: 138379
Loading model from /user/zj2398/cache/mtpp_8k/mtpp_mean_all/best_134150
use_linear_interpolation: False
loss type is labeled_subjects
starting loading model
the hidden size is 768
create loss type is labeled_subjects
the report is LoadReport(renamed_keys=[('transformer.embed_bag.weight', 'backbone.embed_bag.weight'), ('transformer.in_norm.weight', 'backbone.in_norm.weight'), ('transformer.layers.0.input_proj.weight', 'backbone.layers.0.input_proj.weight'), ('transformer.layers.0.norm.weight', 'backbone.layers.0.norm.weight'), ('transformer.layers.0.output_proj.weight', 'backbone.layers.0.output_proj.weight'), ('transformer.layers.1.input_proj.weight', 'backbone.layers.1.input_proj.weight'), ('transformer.layers.1.norm.weight', 'backbone.layers.1.norm.weight'), ('transformer.layers.1.output_proj.weight', 'backbone.layers.1.output_proj.weight'), ('transformer.layers.10.input_proj.weight', 'backbone.layers.10.input_proj.weight'), ('transformer.layers.10.norm.weight', 'backbone.layers.10.norm.weight'), ('transformer.layers.10.output_proj.weight', 'backbone.layers.10.output_proj.weight'), ('transformer.layers.2.input_proj.weight', 'backbone.layers.2.input_proj.weight'), ('transformer.layers.2.norm.weight', 'backbone.layers.2.norm.weight'), ('transformer.layers.2.output_proj.weight', 'backbone.layers.2.output_proj.weight'), ('transformer.layers.3.input_proj.weight', 'backbone.layers.3.input_proj.weight'), ('transformer.layers.3.norm.weight', 'backbone.layers.3.norm.weight'), ('transformer.layers.3.output_proj.weight', 'backbone.layers.3.output_proj.weight'), ('transformer.layers.4.input_proj.weight', 'backbone.layers.4.input_proj.weight'), ('transformer.layers.4.norm.weight', 'backbone.layers.4.norm.weight'), ('transformer.layers.4.output_proj.weight', 'backbone.layers.4.output_proj.weight'), ('transformer.layers.5.input_proj.weight', 'backbone.layers.5.input_proj.weight'), ('transformer.layers.5.norm.weight', 'backbone.layers.5.norm.weight'), ('transformer.layers.5.output_proj.weight', 'backbone.layers.5.output_proj.weight'), ('transformer.layers.6.input_proj.weight', 'backbone.layers.6.input_proj.weight'), ('transformer.layers.6.norm.weight', 'backbone.layers.6.norm.weight'), ('transformer.layers.6.output_proj.weight', 'backbone.layers.6.output_proj.weight'), ('transformer.layers.7.input_proj.weight', 'backbone.layers.7.input_proj.weight'), ('transformer.layers.7.norm.weight', 'backbone.layers.7.norm.weight'), ('transformer.layers.7.output_proj.weight', 'backbone.layers.7.output_proj.weight'), ('transformer.layers.8.input_proj.weight', 'backbone.layers.8.input_proj.weight'), ('transformer.layers.8.norm.weight', 'backbone.layers.8.norm.weight'), ('transformer.layers.8.output_proj.weight', 'backbone.layers.8.output_proj.weight'), ('transformer.layers.9.input_proj.weight', 'backbone.layers.9.input_proj.weight'), ('transformer.layers.9.norm.weight', 'backbone.layers.9.norm.weight'), ('transformer.layers.9.output_proj.weight', 'backbone.layers.9.output_proj.weight'), ('transformer.out_norm.weight', 'backbone.out_norm.weight')], dropped_keys=['task_model.logvars', 'task_model.non_numerical_final_layer.bias', 'task_model.non_numerical_final_layer.weight', 'task_model.non_numerical_task_layer.bias', 'task_model.non_numerical_task_layer.weight', 'task_model.norm.weight', 'task_model.numerical_final_layer.bias', 'task_model.numerical_final_layer.weight', 'task_model.numerical_task_layer.bias', 'task_model.numerical_task_layer.weight'], missing_keys=[], unexpected_keys=[])
The maximum context length is 8192.0,  8 subjects and 65536 tokens per batch
max_length: 8192
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         kens_per_batch "65536"         --device "cuda:0"         --min_subjects_per_batch "8"         --cohort_dir "/shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/pao2/"         --ontology_path "/user/zj2398/cache/motor_mimic_8k/ontology.pkl"         --output_root "/shared/share_mala/zj2398/mimic/regression/motor/"         --loss_type labeled_subjects         --task_type regression 
Using configuration:
  COHORT_BASE_DIR:          /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/
  PRETRAINING_DATA:         /user/zj2398/cache/motor_mimic_8k
  OMOP_MEDS_READER:         /shared/share_mala/zj2398/mimic/meds_v0.6_reader
  NUM_PROC:                 64
  TOKENS_PER_BATCH:         65536
  OBSERVATION_WINDOW:       Not specified
  REGRESSION:               true
  PYTHONPATH head:          /user/zj2398/femr_chao_meds_v3/src
  RUN_ROOT (outputs):       /user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/regression

[1] Found task: bilirubin
[2] Found task: creatinine
[3] Found task: pao2
[4] Found task: platelets
[1/4] Processing task: bilirubin
cohort_base_dir: /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/
Task directory: /shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/bilirubin/
Executing: python -u "/user/zj2398/femr_chao_meds_v3/src/femr/omop_meds_tutorial/evaluation/generate_mtpp_features.py"         --pretraining_data "/user/zj2398/cache/motor_mimic_8k"         --model_path "/user/zj2398/cache/motor_mimic_8k/output/best_100620"         --model_name "motor"         --meds_reader "/shared/share_mala/zj2398/mimic/meds_v0.6_reader"         --num_proc "64"         --tokens_per_batch "65536"         --device "cuda:0"         --min_subjects_per_batch "8"         --cohort_dir "/shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/bilirubin/"         --ontology_path "/user/zj2398/cache/motor_mimic_8k/ontology.pkl"         --output_root "/shared/share_mala/zj2398/mimic/regression/motor/"         --loss_type labeled_subjects         --task_type regression 
label_name of cohort_dir: pao2
/shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/pao2/pao2.parquet
Loading labels from  /shared/share_mala/zj2398/mimic/regression/motor/labels/pao2.parquet
labels head:    subject_id     prediction_time               code  numerical_value
0    10515010 2114-05-16 10:05:00  LAB//50821//mm Hg            244.0
1    10515010 2114-05-16 11:25:00  LAB//50821//mm Hg            299.0
2    10515010 2114-05-16 13:02:00  LAB//50821//mm Hg            159.0
3    10515010 2114-05-16 16:24:00  LAB//50821//mm Hg            136.0
4    10515010 2114-05-16 22:00:00  LAB//50821//mm Hg             41.0
task type is regression
label_name of cohort_dir: bilirubin
/shared/share_mala/zj2398/mimic/regression/cohort/icu_stay_4h/bilirubin/bilirubin.parquet
Loading labels from  /shared/share_mala/zj2398/mimic/regression/motor/labels/bilirubin.parquet
labels head:    subject_id     prediction_time               code  numerical_value
0    10308187 2137-06-12 06:30:00  LAB//50885//mg/dL              0.3
1    10308187 2137-06-12 21:39:00  LAB//50885//mg/dL              0.4
2    10308187 2137-06-23 22:15:00  LAB//50885//mg/dL              0.2
3    10308247 2186-10-30 15:55:00  LAB//50885//mg/dL              5.0
4    10308247 2186-10-31 00:00:00  LAB//50885//mg/dL              6.9
task type is regression
typed_labels length: 439054
Loading model from /user/zj2398/cache/motor_mimic_8k/output/best_100620
use_linear_interpolation: False
loss type is labeled_subjects
starting loading model
typed_labels length: 138379
Loading model from /user/zj2398/cache/motor_mimic_8k/output/best_100620
use_linear_interpolation: False
loss type is labeled_subjects
starting loading model
the hidden size is 768
create loss type is labeled_subjects
the hidden size is 768
create loss type is labeled_subjects
the report is LoadReport(renamed_keys=[('transformer.embed_bag.weight', 'backbone.embed_bag.weight'), ('transformer.in_norm.weight', 'backbone.in_norm.weight'), ('transformer.layers.0.input_proj.weight', 'backbone.layers.0.input_proj.weight'), ('transformer.layers.0.norm.weight', 'backbone.layers.0.norm.weight'), ('transformer.layers.0.output_proj.weight', 'backbone.layers.0.output_proj.weight'), ('transformer.layers.1.input_proj.weight', 'backbone.layers.1.input_proj.weight'), ('transformer.layers.1.norm.weight', 'backbone.layers.1.norm.weight'), ('transformer.layers.1.output_proj.weight', 'backbone.layers.1.output_proj.weight'), ('transformer.layers.10.input_proj.weight', 'backbone.layers.10.input_proj.weight'), ('transformer.layers.10.norm.weight', 'backbone.layers.10.norm.weight'), ('transformer.layers.10.output_proj.weight', 'backbone.layers.10.output_proj.weight'), ('transformer.layers.2.input_proj.weight', 'backbone.layers.2.input_proj.weight'), ('transformer.layers.2.norm.weight', 'backbone.layers.2.norm.weight'), ('transformer.layers.2.output_proj.weight', 'backbone.layers.2.output_proj.weight'), ('transformer.layers.3.input_proj.weight', 'backbone.layers.3.input_proj.weight'), ('transformer.layers.3.norm.weight', 'backbone.layers.3.norm.weight'), ('transformer.layers.3.output_proj.weight', 'backbone.layers.3.output_proj.weight'), ('transformer.layers.4.input_proj.weight', 'backbone.layers.4.input_proj.weight'), ('transformer.layers.4.norm.weight', 'backbone.layers.4.norm.weight'), ('transformer.layers.4.output_proj.weight', 'backbone.layers.4.output_proj.weight'), ('transformer.layers.5.input_proj.weight', 'backbone.layers.5.input_proj.weight'), ('transformer.layers.5.norm.weight', 'backbone.layers.5.norm.weight'), ('transformer.layers.5.output_proj.weight', 'backbone.layers.5.output_proj.weight'), ('transformer.layers.6.input_proj.weight', 'backbone.layers.6.input_proj.weight'), ('transformer.layers.6.norm.weight', 'backbone.layers.6.norm.weight'), ('transformer.layers.6.output_proj.weight', 'backbone.layers.6.output_proj.weight'), ('transformer.layers.7.input_proj.weight', 'backbone.layers.7.input_proj.weight'), ('transformer.layers.7.norm.weight', 'backbone.layers.7.norm.weight'), ('transformer.layers.7.output_proj.weight', 'backbone.layers.7.output_proj.weight'), ('transformer.layers.8.input_proj.weight', 'backbone.layers.8.input_proj.weight'), ('transformer.layers.8.norm.weight', 'backbone.layers.8.norm.weight'), ('transformer.layers.8.output_proj.weight', 'backbone.layers.8.output_proj.weight'), ('transformer.layers.9.input_proj.weight', 'backbone.layers.9.input_proj.weight'), ('transformer.layers.9.norm.weight', 'backbone.layers.9.norm.weight'), ('transformer.layers.9.output_proj.weight', 'backbone.layers.9.output_proj.weight'), ('transformer.out_norm.weight', 'backbone.out_norm.weight')], dropped_keys=['task_model.final_layer.bias', 'task_model.final_layer.weight', 'task_model.norm.weight', 'task_model.task_layer.bias', 'task_model.task_layer.weight', 'task_model.task_time_bias'], missing_keys=[], unexpected_keys=[])
the report is LoadReport(renamed_keys=[('transformer.embed_bag.weight', 'backbone.embed_bag.weight'), ('transformer.in_norm.weight', 'backbone.in_norm.weight'), ('transformer.layers.0.input_proj.weight', 'backbone.layers.0.input_proj.weight'), ('transformer.layers.0.norm.weight', 'backbone.layers.0.norm.weight'), ('transformer.layers.0.output_proj.weight', 'backbone.layers.0.output_proj.weight'), ('transformer.layers.1.input_proj.weight', 'backbone.layers.1.input_proj.weight'), ('transformer.layers.1.norm.weight', 'backbone.layers.1.norm.weight'), ('transformer.layers.1.output_proj.weight', 'backbone.layers.1.output_proj.weight'), ('transformer.layers.10.input_proj.weight', 'backbone.layers.10.input_proj.weight'), ('transformer.layers.10.norm.weight', 'backbone.layers.10.norm.weight'), ('transformer.layers.10.output_proj.weight', 'backbone.layers.10.output_proj.weight'), ('transformer.layers.2.input_proj.weight', 'backbone.layers.2.input_proj.weight'), ('transformer.layers.2.norm.weight', 'backbone.layers.2.norm.weight'), ('transformer.layers.2.output_proj.weight', 'backbone.layers.2.output_proj.weight'), ('transformer.layers.3.input_proj.weight', 'backbone.layers.3.input_proj.weight'), ('transformer.layers.3.norm.weight', 'backbone.layers.3.norm.weight'), ('transformer.layers.3.output_proj.weight', 'backbone.layers.3.output_proj.weight'), ('transformer.layers.4.input_proj.weight', 'backbone.layers.4.input_proj.weight'), ('transformer.layers.4.norm.weight', 'backbone.layers.4.norm.weight'), ('transformer.layers.4.output_proj.weight', 'backbone.layers.4.output_proj.weight'), ('transformer.layers.5.input_proj.weight', 'backbone.layers.5.input_proj.weight'), ('transformer.layers.5.norm.weight', 'backbone.layers.5.norm.weight'), ('transformer.layers.5.output_proj.weight', 'backbone.layers.5.output_proj.weight'), ('transformer.layers.6.input_proj.weight', 'backbone.layers.6.input_proj.weight'), ('transformer.layers.6.norm.weight', 'backbone.layers.6.norm.weight'), ('transformer.layers.6.output_proj.weight', 'backbone.layers.6.output_proj.weight'), ('transformer.layers.7.input_proj.weight', 'backbone.layers.7.input_proj.weight'), ('transformer.layers.7.norm.weight', 'backbone.layers.7.norm.weight'), ('transformer.layers.7.output_proj.weight', 'backbone.layers.7.output_proj.weight'), ('transformer.layers.8.input_proj.weight', 'backbone.layers.8.input_proj.weight'), ('transformer.layers.8.norm.weight', 'backbone.layers.8.norm.weight'), ('transformer.layers.8.output_proj.weight', 'backbone.layers.8.output_proj.weight'), ('transformer.layers.9.input_proj.weight', 'backbone.layers.9.input_proj.weight'), ('transformer.layers.9.norm.weight', 'backbone.layers.9.norm.weight'), ('transformer.layers.9.output_proj.weight', 'backbone.layers.9.output_proj.weight'), ('transformer.out_norm.weight', 'backbone.out_norm.weight')], dropped_keys=['task_model.final_layer.bias', 'task_model.final_layer.weight', 'task_model.norm.weight', 'task_model.task_layer.bias', 'task_model.task_layer.weight', 'task_model.task_time_bias'], missing_keys=[], unexpected_keys=[])
The maximum context length is 8192.0,  8 subjects and 65536 tokens per batch
max_length: 8192
The maximum context length is 8192.0,  8 subjects and 65536 tokens per batch
max_length: 8192
Got batches 15073
